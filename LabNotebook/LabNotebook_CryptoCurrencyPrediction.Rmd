---
title: "CryptoCurrency Prediction Paper: Detailed Documentation"
output:
  html_document:
    df_print: paged
    toc: true
    number_sections: true
    toc_depth: 3
    toc_float: true
---

# Data Collection

## Prices & Volume of Top Five Coins
Based on the website [Coin Market Cap](https://coinmarketcap.com/coins/), the following cryptocurrencies were the top 5 by market cap on 2-26-2018:    
* Bitcoin (\$BTC)    
* Ethereum (\$ETC)    
* Ripple (\$XRP)  
* Bitcoin Cash (\$BCH)  
* Litecoin (\$LTC)   
  
The R code below was used for data collection. The results were saved into [CryptoData-26-2-2018.RData](https://github.com/fmegahed/cryptopredictions/blob/master/Code/DataCollection/Data/CryptoData-26-2-2018.RData) (which can be accessed by clicking the link on the hyperlink.) Note that the output includes a time-series object for each currency, which has the following variables/columns:   
* Open   
* High   
* Low   
* Close   
* Volume   
* Adjusted   
   
The reader is referred to the [Quantmod Package Documentation](https://cran.r-project.org/web/packages/quantmod/quantmod.pdf) for more details on the getSymbols() function.   
   
```{r message=FALSE, warning=FALSE, eval=FALSE}
library(quantmod) #[Ran in Console to Avoid Multiple Loads]
getSymbols(c("BTC-USD","ETH-USD","XRP-USD","BCH-USD","LTC-USD"))
save.image(file = "CryptoData-26-2-2018.RData")
```
   
   
## Extracting Changes in Github Repositories for Each Coin
### Bitcoin
#### Release Versions and Dates
The R code below was used for scraping the Github Release Pages for Bitcoin. The results were saved into [BitCoinGitHub-26-2-2018.RData](https://github.com/fmegahed/cryptopredictions/blob/master/Code/DataCollection/Data/BitcoinGitHub-26-2-2018.RData) (which can be accessed by clicking the link on the hyperlink.) Note that the output includes two data frames:   
* unverified (191 observations for 191 unverified and verified releases of the software)   
* verified (19 observations corresponding to the major/verified updates in the Bitcoin software)   
The reader should note that the scraped dates will need further pre-processing, which we will pursue in a subsequent step. 

```{r message=FALSE, warning=FALSE, eval=FALSE, tidy=TRUE, tidy.opts=list(comment=FALSE)}
#install.packages("pacman") # Unhash if not installed
pacman::p_load(rvest,gsubfn,stringr) # allows multiple loading

# Scraping the Data:
# ------------------
base.url <-"https://github.com/bitcoin/bitcoin/releases?after="
url.git <- "https://github.com/bitcoin/bitcoin/releases?after="
# Initilization for looping
verified.releases <- {}
releases <- {}
verified.releases.dates <- {}
dates <- {}
url.extension <- "placeholder"
# Looping through all bitcoin releases on github
while (url.extension!="v0.1.5") {
  # Step 1: Reading the Data
  github.contents <- readLines(url.git)
  # Step 2: Scraping the data pertaining
  # (A) Obtaining all releases in the url (pages increment)
  releases.holder <- as.data.frame(strapplyc(github.contents,"href=\"/bitcoin/bitcoin/releases/tag/(.*?)\">",simplify = rbind))
  # (B) Obtaining all dates in the url (pages increment)
  dates.holder <- as.data.frame(strapplyc(github.contents, "<relative-time datetime=(.*?) ",simplify = rbind))
  # Step 3: Ensuring that releases and dates match
    # Checked to work in Bitcoin
  if (nrow(dates.holder) != nrow(releases.holder)){
    dates.holder <- unique(dates.holder)
  }
  # Step 4: Getting all verified releases (easier using rvest)
  alt.github.contents <- read_html(url.git)
  verified.releases.holder <- html_nodes(alt.github.contents,"a >                               span.css-truncate-target")
  verified.releases.holder <- data.frame(html_text(verified.releases.holder))
  verified.releases.dates.holder <- html_nodes(alt.github.contents,"p > relative-time")
  verified.releases.dates.holder <- data.frame(html_text(verified.releases.dates.holder))
  
  # Storing the data
  verified.releases <- rbind(verified.releases,verified.releases.holder)
  releases <- rbind(releases,releases.holder)
  verified.releases.dates <- rbind(verified.releases.dates, verified.releases.dates.holder)
  dates <- rbind(dates,dates.holder)
  
  # Going to the next page
  url.extension <- as.character(releases.holder[nrow(releases.holder),1])
  url.git <- paste(base.url,url.extension,sep = "")
  Sys.sleep(2)
}

# Saving the data

verified.btc <- data.frame(cbind(verified.releases.dates,verified.releases))
unverified.btc <- data.frame(cbind(dates,releases))
save(verified.btc,unverified.btc,file = "BitcoinGitHub-26-2-2018.RData")
```
Based on the code above, the number of rows for the unverified data.frame (i.e. total of verified and unverified releases) matched our expectation from: [Screen Capture of the State of the Bitcoin Software as of 2-26-2018](https://github.com/fmegahed/cryptopredictions/blob/master/LabNotebook/Figures/validate.all.releases.bitcoin.JPG) (click on link to see screen capture).

### Ethereum
The R code below was used for scraping the Github Release Pages for Ethereum. The results were saved into [EthereumGitHub-26-2-2018.RData](https://github.com/fmegahed/cryptopredictions/blob/master/Code/DataCollection/Data/EthereumGitHub-26-2-2018.RData) (which can be accessed by clicking the link on the hyperlink.)
```{r message=FALSE, warning=FALSE, eval=FALSE, tidy=TRUE, tidy.opts=list(comment=FALSE)}
#install.packages("pacman") # Unhash if not installed
pacman::p_load(rvest,gsubfn,stringr) # allows multiple loading

# Scraping the Data:
# ------------------
base.url <-"https://github.com/ethereum/go-ethereum/releases?after="
url.git <- "https://github.com/ethereum/go-ethereum/releases?after="
# Initilization for looping
releases <- {}
releases.dates <- {}
url.extension <- "placeholder"
# Looping through all ethereum releases on github
while (url.extension!="0.5.18") {
  alt.github.contents <- read_html(url.git)
  releases.holder <- html_nodes(alt.github.contents,"a > span.css-truncate-target")
  releases.holder <- data.frame(html_text(releases.holder))
  releases.dates.holder <- html_nodes(alt.github.contents,"p > relative-time")
  releases.dates.holder <- data.frame(html_text(releases.dates.holder))
  
  # Storing the data
  releases <- rbind(releases,releases.holder)
  releases.dates <- rbind(releases.dates, releases.dates.holder)
  
  # Going to the next page
  url.extension <- as.character(releases.holder[nrow(releases.holder),1])
  url.git <- paste(base.url,url.extension,sep = "")
  Sys.sleep(2)
}

# Saving the data
release.ethereum <- data.frame(cbind(releases.dates,releases))
```
Note that my initial run of the code resulted in a conclusion that is different than the 125 commits expected from: [Screen Capture of the State of the Ethereum Software as of 2-26-2018](https://github.com/fmegahed/cryptopredictions/blob/master/LabNotebook/Figures/validate.all.releases.ethereum.JPG) (click on link to see screen capture).   
   
Therefore, I had to go through each of the pages to identify which releases were missed. From that experiment, there were two categories of pages that were missed by our scraping code:   
* The first 21 releases since the formatting used to document the releases did not have the version no. on the left margin of the page.   
* Some of the other early releases (involving 1 minor change). These also did not have the same formatting.   
Thus, the code below was added to document and account for the changes. For completeness, please see [Screen Capture of the State of Differences between v1.1.0 (scraped) and v1.0.4 (manually counted)](https://github.com/fmegahed/cryptopredictions/blob/master/LabNotebook/Figures/example.manuallycounted.ethereum.v1.0.4.JPG) for a depiction of how the left margin looks different.
```{r message=FALSE, warning=FALSE, eval=FALSE, tidy=TRUE, tidy.opts=list(comment=FALSE)}
releases.after.0.5.18 <- 21 # manually counted on the pages
# can be easily verified by going through
# https://github.com/ethereum/go-ethereum/releases?after=0.5.18
# and click next (after counting)
other.not.counted <- c('v0.6.3','v0.6.4','v0.6.5-1','v0.6.5-2','PoC6','vv0.7.10', 'v0.7.11','v0.8.4-1', 'v0.8.5-2', 'v0.9.17', '0.9.16', 'v0.9.22', 'v0.9.23 (Non Olympic-Release)', 'v0.9.39','v1.0.4','v1.0.1.2 (aug 20, 2015)','v1.0.5 (Sept 10, 2015','v1.0.1')
totalexpected <- 125
total.scraped.and.manually.counted <- length(other.not.counted) + nrow(release.ethereum) +  releases.after.0.5.18

save(release.ethereum,total.scraped.and.manually.counted,totalexpected, file = "C:/Users/megahefm/Google Drive/Miami/Research/2018/cryptopredictions/LabNotebook/ethereumGitHub-26-2-2018.RData")
```
